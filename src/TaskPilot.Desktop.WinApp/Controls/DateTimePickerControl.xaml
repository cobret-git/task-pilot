<UserControl
    x:Class="TaskPilot.Desktop.WinApp.Controls.DateTimePickerControl"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d">

    <StackPanel>
        <!-- Header -->
        <TextBlock Text="{x:Bind Header, Mode=OneWay}"
                   Margin="0,0,0,4"
                   Visibility="{x:Bind Header, Mode=OneWay, Converter={StaticResource NullToVisibilityConverter}}"
                   Style="{StaticResource BodyTextBlockStyle}"/>

        <DropDownButton x:Name="RootDropDownButton" 
                        HorizontalContentAlignment="Left"
                        HorizontalAlignment="Stretch"
                        VerticalAlignment="Stretch">
            <DropDownButton.Content>
                <Grid>
                    <!-- Show placeholder when no date selected -->
                    <StackPanel Orientation="Horizontal"
                            Visibility="{x:Bind IsDateTimeNull, Mode=OneWay}">
                        <TextBlock Text="{x:Bind PlaceholderText, Mode=OneWay}"/>
                        <FontIcon Margin="6,0,0,0" 
                              Glyph="&#xE787;" 
                              FontFamily="{StaticResource SymbolThemeFontFamily}"/>
                    </StackPanel>

                    <!-- Show selected date and time when available -->
                    <StackPanel Orientation="Horizontal"
                            Visibility="{x:Bind IsDateTimeNotNull, Mode=OneWay}">
                        <TextBlock Text="{x:Bind DisplayDateText, Mode=OneWay}"/>
                        <TextBlock Text="{x:Bind DisplayTimeText, Mode=OneWay}"
                               Margin="4,0,0,0"
                               Visibility="{x:Bind IsTimeNotNull, Mode=OneWay}"/>
                        <FontIcon Margin="6,0,0,0" 
                              Glyph="&#xE787;"
                              FontFamily="{StaticResource SymbolThemeFontFamily}"/>
                    </StackPanel>
                </Grid>
            </DropDownButton.Content>

            <DropDownButton.Flyout>
                <Flyout x:Name="DateTimeFlyout"
                        Placement="RightEdgeAlignedBottom" AreOpenCloseAnimationsEnabled="True"
                        Opened="DateTimeFlyout_Opened"
                        Closed="DateTimeFlyout_Closed">
                    <Grid RowSpacing="12">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <CalendarView x:Name="DateCalendar"
                                      Grid.Row="0"
                                      HorizontalAlignment="Stretch"
                                      VerticalAlignment="Top"
                                      SelectionMode="Single"
                                      SelectedDatesChanged="DateCalendar_SelectedDatesChanged"/>

                        <TextBlock Grid.Row="1" 
                                   Text="Select Time:"
                                   HorizontalAlignment="Left"
                                   HorizontalTextAlignment="Left"
                                   Style="{StaticResource BodyStrongTextBlockStyle}"/>

                        <Border Grid.Row="2"
                                HorizontalAlignment="Stretch"
                                BorderThickness="1"
                                BorderBrush="{ThemeResource SurfaceStrokeColorDefault}"
                                Background="{ThemeResource CalendarViewBackground}"
                                CornerRadius="4">
                            <Grid>
                                <Grid.Resources>
                                    <Style TargetType="ToggleButton" BasedOn="{StaticResource DefaultToggleButtonStyle}">
                                        <Setter Property="Background" Value="Transparent"/>
                                        <Setter Property="HorizontalAlignment" Value="Stretch"/>
                                        <Setter Property="BorderThickness" Value="0"/>
                                    </Style>
                                </Grid.Resources>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <ToggleButton Grid.Column="0" 
                                              Content="All-day" 
                                              IsChecked="{x:Bind IsNoTimeSelected, Mode=OneWay}"
                                              Click="NoTimeToggle_Click"/>
                                <ToggleButton Grid.Column="1" 
                                              Content="Specific time"
                                              IsChecked="{x:Bind IsWithTimeSelected, Mode=OneWay}"
                                              Click="WithTimeToggle_Click"/>
                            </Grid>
                        </Border>

                        <TimePicker x:Name="TimePicker"
                                    Grid.Row="3"
                                    HorizontalAlignment="Stretch"
                                    ClockIdentifier="24HourClock"
                                    Visibility="{x:Bind IsWithTimeSelected, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"
                                    TimeChanged="TimePicker_TimeChanged"/>

                        <StackPanel Grid.Row="4"
                                    Orientation="Horizontal"
                                    HorizontalAlignment="Right">
                            <Button Content="Done"
                                    Style="{StaticResource AccentButtonStyle}"
                                    Click="SaveButton_Click"
                                    IsEnabled="{x:Bind IsTempDateNotNull, Mode=OneWay}"/>
                            <Button Content="Cancel"
                                    Margin="8,0,0,0"
                                    Click="CancelButton_Click"/>
                        </StackPanel>
                    </Grid>
                </Flyout>
            </DropDownButton.Flyout>
        </DropDownButton>
    </StackPanel>
</UserControl>
